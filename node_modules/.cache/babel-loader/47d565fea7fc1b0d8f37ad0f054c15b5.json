{"ast":null,"code":"import _objectSpread from\"/Users/macbookpro/Documents/my-repository/web/cambridge-anki/extention/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/macbookpro/Documents/my-repository/web/cambridge-anki/extention/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/macbookpro/Documents/my-repository/web/cambridge-anki/extention/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectWithoutProperties from\"/Users/macbookpro/Documents/my-repository/web/cambridge-anki/extention/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"contentValue\",\"id\",\"component\",\"onContentChange\",\"onInput\"];import React,{useEffect,useState}from'react';import uniqid from'uniqid';import{getCaretPosition}from'utils/helpers/getCaretPosition';import{setCaretPosition}from'utils/helpers/setCaretPosition';import{jsx as _jsx}from\"react/jsx-runtime\";var brId=uniqid('br-');var ContentEditable=function ContentEditable(_ref){var contentValue=_ref.contentValue,oldId=_ref.id,component=_ref.component,_ref$onContentChange=_ref.onContentChange,onContentChange=_ref$onContentChange===void 0?function(){}:_ref$onContentChange,_ref$onInput=_ref.onInput,_onInput=_ref$onInput===void 0?function(){}:_ref$onInput,other=_objectWithoutProperties(_ref,_excluded);var Component=component||'div';var id=uniqid('content-editable-');var _useState=useState(),_useState2=_slicedToArray(_useState,2),caret=_useState2[0],setCaret=_useState2[1];var resetNodes=function resetNodes(selector){var element=document.querySelector(selector);if(element)element.innerHTML='';};var setContent=function setContent(selector,newContent){var element=document.querySelector(selector);if(element&&newContent){element.innerHTML='';newContent.forEach(function(node,i){var wrapedNode=document.createElement('div');if(node===brId){var br=document.createElement('br');wrapedNode.append(br);}else{wrapedNode.innerHTML=node;}element.append(wrapedNode);});console.log('Childrens have been appended!');}else if(element&&!newContent){element.innerHTML='';console.log('Element has been cleaned');}if(caret)setCaretPosition(id,caret.nodeIndex,caret.caretPosition);};useEffect(function(){setContent(\"#\".concat(id),contentValue);},[contentValue]);function handleChange(e){var _e$currentTarget$chil,_e$currentTarget$chil2,_e$currentTarget$chil3;var imgMaxWidth=e.currentTarget.clientWidth-30;var allImg=e.currentTarget.getElementsByTagName('img');for(var i=0;i<allImg.length;i++){var img=allImg[i];if(img.width>imgMaxWidth)img.width=imgMaxWidth;}var parsedNodes=[];var firstText=((_e$currentTarget$chil=e.currentTarget.childNodes[0])===null||_e$currentTarget$chil===void 0?void 0:_e$currentTarget$chil.nodeName)==='#text'?(_e$currentTarget$chil2=e.currentTarget.childNodes[0])===null||_e$currentTarget$chil2===void 0?void 0:_e$currentTarget$chil2.textContent:undefined;var firstImg=((_e$currentTarget$chil3=e.currentTarget.children[0])===null||_e$currentTarget$chil3===void 0?void 0:_e$currentTarget$chil3.tagName)==='IMG'?e.currentTarget.getElementsByTagName('img')[0].outerHTML:undefined;var nodes=e.currentTarget.getElementsByTagName('div');firstImg&&parsedNodes.push(firstImg);firstText&&parsedNodes.push(firstText);if(nodes.length===0){var caretPosition=getCaretPosition(e.currentTarget);if(caretPosition){console.log({nodeIndex:0,caretPosition:caretPosition[0]});setCaret({nodeIndex:0,caretPosition:caretPosition[0]});}}for(var _i=0;_i<nodes.length;_i++){var _currentNode$children,_currentNode$children2;var currentNode=nodes[_i];var imgs=[];var text=void 0;var _caretPosition=getCaretPosition(currentNode);if(_caretPosition){console.log({nodeIndex:_i,caretPosition:_caretPosition[0]});setCaret({nodeIndex:_i,caretPosition:_caretPosition[0]});}if(((_currentNode$children=currentNode.children[0])===null||_currentNode$children===void 0?void 0:_currentNode$children.tagName)==='BR'&&currentNode.childElementCount===1){text=brId;}else if(((_currentNode$children2=currentNode.children[0])===null||_currentNode$children2===void 0?void 0:_currentNode$children2.tagName)==='IMG'){var imgElements=currentNode.getElementsByTagName('img');// img = (currentImg?.outerHTML);\nfor(var _i2=0;_i2<imgElements.length;_i2++){var _img=imgElements[_i2];if(_img.width>imgMaxWidth)_img.width=imgMaxWidth;imgs.push(_img.outerHTML);}}else if(currentNode.textContent){text=currentNode.textContent;}parsedNodes=[].concat(_toConsumableArray(parsedNodes),imgs);text&&parsedNodes.push(text);}console.log(parsedNodes);onContentChange(parsedNodes);// setContent(`#${id}`, contentValue);\n// resetNodes(`#${id}`);\n}return/*#__PURE__*/_jsx(Component,_objectSpread({id:id,contentEditable:true,onInput:function onInput(e){handleChange(e);_onInput(e);}},other));};export default ContentEditable;","map":{"version":3,"names":["React","useEffect","useState","uniqid","getCaretPosition","setCaretPosition","brId","ContentEditable","contentValue","oldId","id","component","onContentChange","onInput","other","Component","caret","setCaret","resetNodes","selector","element","document","querySelector","innerHTML","setContent","newContent","forEach","node","i","wrapedNode","createElement","br","append","console","log","nodeIndex","caretPosition","handleChange","e","imgMaxWidth","currentTarget","clientWidth","allImg","getElementsByTagName","length","img","width","parsedNodes","firstText","childNodes","nodeName","textContent","undefined","firstImg","children","tagName","outerHTML","nodes","push","currentNode","imgs","text","childElementCount","imgElements"],"sources":["/Users/macbookpro/Documents/my-repository/web/cambridge-anki/extention/src/components/ContentEditable/ContentEditable.tsx"],"sourcesContent":["import React, { FC, ReactNode, useEffect, useRef, useState } from 'react';\nimport { Type } from 'typescript';\nimport uniqid from 'uniqid';\nimport ReactHTMLParser from 'react-html-parser';\nimport { getCaretPosition } from 'utils/helpers/getCaretPosition';\nimport { setCaretPosition } from 'utils/helpers/setCaretPosition';\nconst brId = uniqid('br-');\n\nexport type IContentEditableProps<T extends React.ElementType> = {\n  component?: T;\n  onContentChange?: (event: string[]) => void;\n  contentValue?: string[];\n} & React.ComponentPropsWithoutRef<T>;\n\nconst ContentEditable = <T extends React.ElementType = 'div',>({ contentValue, id: oldId, component, onContentChange = () => {}, onInput = () => {}, ...other }: IContentEditableProps<T>) => {\n  const Component = component || 'div';\n  const id = uniqid('content-editable-');\n  const [caret, setCaret] = useState<{nodeIndex: number, caretPosition: number} | undefined>();\n\n  const resetNodes = (selector: string) => {\n    const element = document.querySelector(selector);\n    if (element) element.innerHTML = '';\n  }\n\n  const setContent = (selector: string, newContent?: string[] | undefined) => {\n    const element = document.querySelector(selector);\n    if (element && newContent) {\n      element.innerHTML = '';\n      newContent.forEach((node, i) => {\n        const wrapedNode = document.createElement('div')\n        if (node === brId) {\n          const br = document.createElement('br');\n          wrapedNode.append(br);\n        } else {\n          wrapedNode.innerHTML = node;\n        }\n        element.append(wrapedNode);\n      })\n      console.log('Childrens have been appended!')\n    } else if (element && !newContent) {\n      element.innerHTML = '';\n      console.log('Element has been cleaned')\n    }\n    \n    if (caret) setCaretPosition(id, caret.nodeIndex, caret.caretPosition);\n  }\n\n  useEffect(() => {\n    setContent(`#${id}`, contentValue);\n  }, [contentValue])\n\n  function handleChange(e: React.FormEvent<HTMLDivElement>) {\n    const imgMaxWidth = e.currentTarget.clientWidth - 30;\n    const allImg = e.currentTarget.getElementsByTagName('img');\n    for (let i = 0; i < allImg.length; i++) {\n      const img = allImg[i];\n      if (img.width > imgMaxWidth)\n        img.width = imgMaxWidth;\n    }\n\n    let parsedNodes: string[] = [];\n    const firstText = e.currentTarget.childNodes[0]?.nodeName === '#text' ? e.currentTarget.childNodes[0]?.textContent : undefined;\n    const firstImg = e.currentTarget.children[0]?.tagName === 'IMG' ? e.currentTarget.getElementsByTagName('img')[0].outerHTML : undefined;\n    const nodes = e.currentTarget.getElementsByTagName('div');\n\n    firstImg && parsedNodes.push(firstImg);\n    firstText && parsedNodes.push(firstText);\n\n    if (nodes.length === 0) {\n      const caretPosition = getCaretPosition(e.currentTarget);\n      if (caretPosition) {\n        console.log({nodeIndex: 0, caretPosition: caretPosition[0]})\n        setCaret({nodeIndex: 0, caretPosition: caretPosition[0]})\n      }\n    }\n\n    for (let i = 0; i < nodes.length; i++) {\n      const currentNode = nodes[i];\n      let imgs: string[] = [];\n      let text: string | undefined;\n\n      const caretPosition = getCaretPosition(currentNode);\n      if (caretPosition) {\n        console.log({nodeIndex: i, caretPosition: caretPosition[0]})\n        setCaret({nodeIndex: i, caretPosition: caretPosition[0]})\n      }\n\n      if (currentNode.children[0]?.tagName === 'BR' && currentNode.childElementCount === 1) {\n        text = brId;\n      } else if (currentNode.children[0]?.tagName === 'IMG') {\n        const imgElements = currentNode.getElementsByTagName('img');\n        // img = (currentImg?.outerHTML);\n        for (let i = 0; i < imgElements.length; i++) {\n          const img = imgElements[i];\n          if (img.width > imgMaxWidth)\n            img.width = imgMaxWidth;\n          imgs.push(img.outerHTML);\n        }\n      } else if (currentNode.textContent) {\n        text = currentNode.textContent;\n      }\n      parsedNodes = [...parsedNodes, ...imgs];\n      text && parsedNodes.push(text);\n    }\n    console.log(parsedNodes);\n    onContentChange(parsedNodes);\n    // setContent(`#${id}`, contentValue);\n    // resetNodes(`#${id}`);\n  }\n\n  return (\n    <Component\n      id={id}\n      contentEditable\n      onInput={(e) => {handleChange(e); onInput(e)}}\n      {...other}\n    >\n      {/* {contentValue?.map((node) => (\n        <div dangerouslySetInnerHTML={{ __html: node }} />\n      ))} */}\n    </Component>\n  )\n};\n\nexport default ContentEditable;"],"mappings":"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"},"metadata":{},"sourceType":"module"}